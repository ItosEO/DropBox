<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="DropBox.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:DropBox"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="DropBox">

    <Grid x:Name="RootGrid" 
          Background="#1E1E1E"
          AllowDrop="True"
          DragOver="Grid_DragOver"
          Drop="Grid_Drop"
          CornerRadius="8">
        
        <Grid.RowDefinitions>
            <RowDefinition Height="32"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        
        <!-- 标题栏区域（带拖动条） -->
        <Grid Grid.Row="0" 
              x:Name="DragBar"
              Background="Transparent"
              CornerRadius="8,8,0,0">
            <Rectangle Width="30" 
                      Height="3" 
                      Fill="#808080" 
                      RadiusX="2" 
                      RadiusY="2"
                      HorizontalAlignment="Center"
                      VerticalAlignment="Center"/>
        </Grid>
        
        <!-- 拖放区域 -->
        <Grid Grid.Row="1" x:Name="DropZone" Padding="16">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
            </Grid.RowDefinitions>

            <!-- 提示文本 -->
            <StackPanel Grid.Row="0" 
                       x:Name="EmptyStatePanel"
                       VerticalAlignment="Center"
                       HorizontalAlignment="Center"
                       Margin="0,30,0,0">
                <TextBlock Text="Drop items here" 
                          FontSize="18"
                          FontWeight="SemiBold"
                          Foreground="#B0B0B0"
                          HorizontalAlignment="Center"
                          Margin="0,0,0,16"/>
                
                <Border Background="#2D2D2D"
                       CornerRadius="6"
                       Padding="12,6"
                       HorizontalAlignment="Center">
                    <TextBlock x:Name="ItemCountText"
                              Text="0 items"
                              FontSize="12"
                              Foreground="#808080"/>
                </Border>
            </StackPanel>

            <!-- 项目列表 -->
            <ScrollViewer Grid.Row="1" 
                         Margin="0,20,0,0"
                         VerticalScrollBarVisibility="Auto">
                <ItemsControl x:Name="ItemsListView" ItemsSource="{x:Bind Items, Mode=OneWay}">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate x:DataType="local:DropItem">
                            <Grid Margin="0,0,0,8"
                                 Background="#2D2D2D"
                                 CornerRadius="8"
                                 Padding="12"
                                 CanDrag="True"
                                 DragStarting="Item_DragStarting"
                                 AllowDrop="False">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- 图标 -->
                                <FontIcon Grid.Column="0"
                                         Glyph="{x:Bind IconGlyph}"
                                         FontSize="20"
                                         Foreground="#808080"
                                         Margin="0,0,12,0"/>

                                <!-- 文件信息 -->
                                <StackPanel Grid.Column="1" VerticalAlignment="Center">
                                    <TextBlock Text="{x:Bind Name}"
                                              Foreground="White"
                                              FontSize="14"
                                              TextTrimming="CharacterEllipsis"/>
                                    <TextBlock Text="{x:Bind Description}"
                                              Foreground="#808080"
                                              FontSize="12"
                                              TextTrimming="CharacterEllipsis"
                                              Margin="0,2,0,0"/>
                                </StackPanel>

                                <!-- 删除按钮 -->
                                <Button Grid.Column="2"
                                       Content="&#xE711;"
                                       FontFamily="Segoe MDL2 Assets"
                                       Width="32"
                                       Height="32"
                                       Background="Transparent"
                                       Foreground="#808080"
                                       BorderThickness="0"
                                       Click="DeleteItem_Click"
                                       Tag="{x:Bind}">
                                    <Button.Resources>
                                        <SolidColorBrush x:Key="ButtonBackgroundPointerOver" Color="#3D3D3D"/>
                                        <SolidColorBrush x:Key="ButtonBackgroundPressed" Color="#4D4D4D"/>
                                        <SolidColorBrush x:Key="ButtonForegroundPointerOver" Color="White"/>
                                    </Button.Resources>
                                </Button>
                            </Grid>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>
        </Grid>

        <!-- 拖放提示覆盖层 -->
        <Border x:Name="DragOverlay"
               Grid.RowSpan="2"
               Background="#80000000"
               Visibility="Collapsed"
               CornerRadius="8"
               IsHitTestVisible="False">
            <Border Background="#3D3D3D"
                   BorderBrush="#4A9EFF"
                   BorderThickness="2"
                   CornerRadius="8"
                   Margin="20"
                   Padding="40">
                <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                    <FontIcon Glyph="&#xE896;"
                             FontSize="48"
                             Foreground="#4A9EFF"
                             HorizontalAlignment="Center"/>
                    <TextBlock Text="释放以添加项目"
                              FontSize="20"
                              Foreground="White"
                              HorizontalAlignment="Center"
                              Margin="0,16,0,0"/>
                </StackPanel>
            </Border>
        </Border>
    </Grid>
</Window>
